{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
  <h2>Nueva Venta</h2>
  <form action="{% url 'create-sale' %}" method="post">
    {% csrf_token %}
    {{ form.user|as_crispy_field }}
    {{ form.customer|as_crispy_field }}
    {{ form.product|as_crispy_field }}
    {{ form.price|as_crispy_field }}
    <div class="row">
      <div class="col-6">
        {{ form.installment_amount|as_crispy_field }}
      </div>
      <div class="col-6">
        {{ form.installments|as_crispy_field }}
      </div>
    </div>
    <div>
      Esquema de Pago:
      <table class="table">
        {% comment %} <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">First</th>
            <th scope="col">Last</th>
            <th scope="col">Handle</th>
          </tr>
        </thead> {% endcomment %}
        <tbody>
          <tr>
            <th scope="row" id="i"></th>
            <td>cuotas de</td>
            <td id="i_amount"></td>
          </tr>
          <tr>
            <th scope="row">1</th>
            <td>cuota de</td>
            <td id="rest_amount"></td>
          </tr>
        </tbody>
      </table>
    </div>
    <input type="submit" value="Guardar Venta" class="btn btn-primary">
  </form>
{% endblock %}

{% block extra_js %}
<script>
  const priceInput = document.getElementById('id_price');
  const installmentInput = document.getElementById('id_installments');
  const installmentAmountInput = document.getElementById('id_installment_amount');
  const quantity = document.getElementById('quantity');
  const i = document.getElementById('i');
  const iAmount = document.getElementById('i_amount');
  const restAmount = document.getElementById('rest_amount');

  installmentAmountInput.addEventListener('keyup', e => {
    const price = parseFloat(priceInput.value);
    console.log(price);
    const installmentAmount = parseFloat(installmentAmountInput.value);
    console.log(installmentAmount);

    const installmentsQuantity = price / installmentAmount;
    console.log(installmentsQuantity);

    if(Number.isInteger(installmentsQuantity)) {
      i.innerText = installmentsQuantity;
      iAmount.innerText = installmentAmount;
    } else {
      i.innerText = Math.trunc(installmentsQuantity) - 1;
      iAmount.innerText = installmentAmount;
      restAmount.innerText = price - ((Math.trunc(installmentsQuantity) - 1) * installmentAmount);
    }
  });
</script>
{% endblock %}